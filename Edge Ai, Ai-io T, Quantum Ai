# Notebook: edge_ai_recyclables.ipynb
# Python 3; run in Colab or local Jupyter

import tensorflow as tf
from tensorflow.keras import layers, models
import numpy as np
import os

# === PARAMETERS ===
BATCH_SIZE = 32
IMG_SIZE = (160, 160) # small enough for edge
DATA_DIR = '/content/data' # set to your dataset root
EPOCHS = 10
MODEL_NAME = 'recycle_mobilenetv2'

# === LOAD DATA (expects directory structure train/val/test) ===
train_ds = tf.keras.preprocessing.image_dataset_from_directory(
os.path.join(DATA_DIR, 'train'),
image_size=IMG_SIZE,
batch_size=BATCH_SIZE)

val_ds = tf.keras.preprocessing.image_dataset_from_directory(
os.path.join(DATA_DIR, 'val'),
image_size=IMG_SIZE,
batch_size=BATCH_SIZE)

class_names = train_ds.class_names
num_classes = len(class_names)
print('Classes:', class_names)

# === PREFETCH / PERFORMANCE ===
AUTOTUNE = tf.data.AUTOTUNE
train_ds = train_ds.cache().prefetch(buffer_size=AUTOTUNE)
val_ds = val_ds.cache().prefetch(buffer_size=AUTOTUNE)

# === MODEL (MobileNetV2 base + small head) ===
base_model = tf.keras.applications.MobileNetV2(input_shape=IMG_SIZE + (3,),
include_top=False,
weights='imagenet')
base_model.trainable = False # transfer learning

inputs = tf.keras.Input(shape=IMG_SIZE + (3,))
(x) = tf.keras.applications.mobilenet_v2.preprocess_input(inputs)
(x) = base_model(x, training=False)
(x) = layers.GlobalAveragePooling2D()(x)
(x) = layers.Dropout(0.2)(x)
outputs = layers.Dense(num_classes, activation='softmax')(x)
model = models.Model(inputs, outputs)

model.compile(optimizer='adam',
loss='sparse_categorical_crossentropy',
metrics=['accuracy'])


model.summary()


# === TRAIN ===
f.write('\n'.join(class_names))
